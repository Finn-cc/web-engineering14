# 仿百度网盘项目需求文档

## 项目简介

仿百度网盘项目 **Easy云盘** 是一个个人云存储与分享平台，提供类似百度网盘的文件上传、下载、预览、分享及管理功能。用户可以通过网页进行文件的存储和管理，包括：用户注册登录、文件的批量上传和断点续传、各类文件在线预览、生成分享链接供他人访问、回收站管理已删文件、以及后台管理员对用户和系统的管理等。项目采用前后端分离架构（前端基于 Vue3 + Vite，后端提供 RESTful API 服务），支持高并发文件传输和安全的访问控制，旨在打造稳定高效的网盘系统。

## 系统架构概述

![image](https://github.com/HLH0423/EasyPan/assets/54101102/5a1e626c-d958-4df7-8627-06afa062f735)

 *系统功能架构示意图：整体分为“我的网盘”（用户内部功能）和“外部分享”两大部分，涵盖登录注册、文件管理、分享与回收站、以及管理员设置等模块。左侧为外部分享功能（通过分享链接查看文件列表、媒体文件预览、保存到网盘等），右侧为用户个人网盘功能（登录注册、文件上传/下载、各种文件在线预览、分享管理、删除与回收站、以及管理员设置)。*

**架构说明：** 系统由前端网页和后端服务组成。前端主要提供用户界面，包括登录注册页面、网盘主界面、分享访问页面和管理员后台等。后端负责业务逻辑和数据存储，提供用户管理、文件操作、分享机制等API接口，以及将文件存储于服务器文件系统或云存储中。前后端通过 HTTP 接口交互，采用 Token 等机制验证用户身份，保证数据安全。整个系统功能模块如上图所示，用户登录后进入“我的网盘”模块，可以上传管理自己的文件；通过“分享”模块生成分享链接，未登录用户通过“外部分享”模块访问共享的文件；“回收站”模块暂存用户删除的文件；“管理员设置”模块由管理员账号使用，包含对所有用户及系统参数的管理功能。

## 功能性需求

功能需求按照模块划分如下：

### 用户注册与登录

未注册用户可以通过注册功能创建账户，已注册用户可凭邮箱和密码登录。支持第三方登录方式（例如QQ登录）以及找回密码功能。所有用户相关操作均需进行基本验证，例如图形验证码和邮箱验证码，以确保安全性。
 *登录页面：用户输入注册邮箱和密码登录。支持“记住我”选项以及第三方QQ快速登录。右侧提供“忘记密码？”和“没有账号？去注册”链接。下方有图形验证码输入框，防止恶意登录尝试。*

- **登录：** 用户使用邮箱和密码登录，登录表单需输入**邮箱**、**密码**以及页面提供的**图形验证码**。密码在前端进行MD5散列后传输，提高安全性 ([EasyPan(1).html](file://xn--file-dzcht9xmyu9zqsgnjajdrk%23:~:text=ary":"","deprecated":false,"description":"```text\n\n```\n","tags":["eas ypan%2F"],"parameters":[],"requestbody":{"content":{"multipart%2Fform,nick-25993amy2j9uzwmcas717jz69cyp0a512yjdmoqcax4143dssod/))。登录接口校验凭证后，返回用户基本信息和会话令牌。支持QQ一键登录功能，点击“快速登录 (QQ)”跳转QQ授权。登录成功后进入用户网盘主页。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/8822feec-68f9-4acb-98e1-3e6a6f002117)
 *注册页面：新用户填写邮箱、收到的邮箱验证码、昵称、密码和确认密码，并输入图形验证码完成注册。点击“获取验证码”按钮发送邮件验证码。*

- **注册：** 新用户填写注册表单，需提供**邮箱**、**昵称**、**密码**及**确认密码**，并输入**图形验证码**和**邮箱验证码**完成验证。首次点击“获取验证码”按钮后，会向填写的邮箱发送一封包含6位数字验证码的邮件 。注册接口会校验邮箱验证码和图形验证码有效性，然后创建用户账户，默认分配一定的存储空间（如初始5GB）。注册邮箱需唯一，密码需符合复杂度要求（8-18位，包含字母数字或特殊字符）。注册成功后可直接登录或跳转到登录页。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/e0d53b4e-4fc1-4395-8c80-d3eb6cba010d)
 *找回密码页面：用户输入注册邮箱并获取邮箱验证码，设置新密码并再次输入确认，同时填写图形验证码。验证通过后即可重置密码。*

- **找回密码：** 当用户忘记密码时，可通过邮箱重置。流程与注册类似：输入注册邮箱，点击获取验证码后，系统发送重置密码的邮箱验证码；用户填写收到的验证码、新密码以及**图形验证码**，提交后即重置密码成功 。新密码设置成功后，可用于后续登录。找回密码链接通常在登录页提供快捷入口。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/8ab4f9c4-ca5c-447c-9515-fece9df8c41e)
 *发送邮箱验证码弹窗：在注册或找回密码流程中，用户点击“获取验证码”后弹出此对话框，需要输入图形验证码以发送邮件。防止恶意反复请求邮件验证码。*

- **验证码获取：** 无论注册还是找回密码，当用户点击“获取验证码”按钮时，会弹出如上图所示的验证对话框，要求输入一次**图形验证码**后才能发送邮件验证码。这一机制防止恶意重复请求邮件。邮件内容和标题可在后台“系统设置”中配置，例如默认标题是“邮箱验证码”，内容模板如“你好，您的邮箱验证码是：%s，15分钟有效”。图形验证码通过`GET /api/checkCode`接口获取（`type=0`用于注册/登录页面） 。邮箱验证码发送通过`POST /api/sendEmailCode`接口，需提交邮箱地址和图形验证码 。每封验证码邮件有效期一般为15分钟。

  ![image](https://github.com/HLH0423/EasyPan/assets/54101102/28df267a-95fb-423e-8d28-54f8205c4df6)

**（注意：）**登录、注册和找回密码等接口的详细参数见后文“接口文档”部分，例如注册接口`/api/register`要求提供邮箱、昵称、密码、图形验证码和邮箱验证码 。用户登录状态维持可采用 Token 机制，用户每次请求需在请求头附加授权 Token。支持用户注销登录（调用`GET /api/logout`接口，销毁会话）。

### 网盘主页

已登录用户进入**网盘主页**，可以浏览管理自己的云端文件。网盘主页主要区域包括：左侧边栏的文件分类筛选，顶部的操作按钮和搜索框，以及文件列表区域。用户在此页面可以上传文件、新建文件夹，对文件进行预览、重命名、移动、删除、分享等操作，并可通过搜索功能按名称关键词查找文件。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/b4b2711e-dfdf-4724-8173-21d43a283e27)
 *网盘主界面：左侧为分类筛选（全部、视频、音乐、图片、文档、其他），中上方为操作按钮（上传、新建文件夹、批量删除、批量移动）和搜索框。右侧主区域显示当前目录的文件列表（如图为空目录时提示上传文件)。底部显示存储空间使用情况。*

- **文件列表：** 网盘主页默认显示用户“全部文件”目录下的内容。左侧提供六类文件筛选标签：**全部**、**视频**、**音乐**、**图片**、**文档**、**其他**。用户点击不同分类，可以按文件类型过滤列表显示（例如只看图片或文档）。文件列表按表格形式展示文件/文件夹名称、最近修改时间、大小等信息，并支持分页查看。当目录为空时，页面中央会提示“当前目录为空，上传你的第一个文件吧”，并提供快捷的“上传文件”和“新建目录”按钮。底部会显示当前账号已用空间及总空间，比如“0B/1GB”。用户可以在顶部搜索框输入文件名关键词实时搜索匹配的文件 ,文件列表通过分页接口`POST /api/file/loadDataList`获取，支持按父目录ID、名称模糊搜索等参数查询 
- **新建文件夹：** 用户点击“新建文件夹”按钮，可在当前目录下创建子文件夹。系统会弹出输入框让用户填写文件夹名称，如下图所示。文件夹创建接口`POST /api/file/newFolder`需要提供父目录ID（`filePid`）和文件夹名称（`fileName`） 。创建成功后，页面文件列表刷新显示新文件夹条目。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/42e23991-ff6e-40c0-8b39-4de2b5e38ea9)
 *新建文件夹：在文件列表顶部出现文件夹名称输入栏，用户输入名称后点击勾号确认或叉号取消。确认后将调用后台接口创建该目录。*

- **文件排序与分页：** 文件列表默认按照名称或时间排序，可实现点击列头排序（如果有提供）。当文件众多时支持分页浏览，每页默认显示一定数量（如15个） 。分页参数通过接口传递（如`pageNo`第几页，`pageSize`每页条数）。接口返回总条目数和总页数便于前端渲染分页控件。

### 文件上传与下载

网盘系统支持**批量文件上传**，包括大文件的分片上传、断点续传和秒传（快速上传）。用户可一次选择多个文件上传，上传过程中可以看到每个文件的进度，已上传的分片大小等。上传完成的文件存储在当前所在目录下。系统还支持文件的下载：用户可单个或批量下载自己网盘中的文件，对于不支持在线预览的文件（例如ZIP压缩包），点击文件名会直接提示下载。

- **批量上传：** 用户点击“上传”按钮后，在文件选择框中可多选一个或多个文件开始上传。上传过程中，界面会出现一个“上传任务列表”侧栏，展示每个文件的上传状态和进度条。例如下图所示，有多个文件同时上传，每个文件右侧显示进度百分比，文件名下方标注状态（“上传完成”或“秒传完成”表示上传成功，“暂停中”表示用户暂停，“上传失败”则会显示错误原因）。用户可在上传列表中取消某个正在上传的文件。已完成或取消的任务可从列表中清除。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/d94b50b3-53da-4e10-b505-89e24544d131)
 *批量上传任务列表：用户一次性选择多个文件后，右侧显示上传进度列表。支持大文件分片上传，进度条显示每个文件已上传的分片比例。部分文件标记“秒传完成”表示服务器已存在相同文件，无需重复上传即完成。用户可以暂停或取消任务。下方分别显示不同文件的上传状态。*

上传功能要求后端支持**分片上传**机制：前端将大文件切分为多个块依次上传，并记录已传输的块，实现断点续传。秒传是指如果服务器检测到上传文件的MD5已存在，则可直接标记上传完成，无需实际上传数据。具体实现上，上传接口`POST /api/file/uploadFile`会接受以下参数：

- `fileId`：文件ID，用于续传时标识文件（首次上传可为空，由服务器返回新的fileId用于后续分片）。
- `file`：当前分片的二进制内容（文件流）。
- `fileName`：文件名。
- `filePid`：目标父目录ID（所在文件夹）。
- `fileMd5`：整个文件的MD5校验值（用于秒传判断）。
- `chunkIndex`：当前上传的分片序号（从0或1开始）。
- `chunks`：总分片数。

以上参数中，服务器通过`fileMd5`判断是否已有相同文件存储，如果是则立即返回“秒传完成”状态，无需上传后续内容。 否则服务器逐个接收分片并存储，直至最后一片，完成后合并文件并保存元数据。对于网络中断或手动暂停的任务，用户下次上传同一文件时，前端可先询问服务器已收到的分片（通过已存在的fileId或MD5确定），实现断点续传。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/8c890417-2de5-4045-9371-14ff00ed0f6c)
 *文件列表显示上传后的文件：如图上传完成后，“全部文件”目录下显示新上传的文件条目，包括其大小和上传时间等信息。用户可以通过左侧的“视频”“文档”等分类过滤这些文件。*

上传完成后，文件列表会自动刷新，显示新上传的文件（如上图）。文件元数据包括文件大小、上传时间等都会更新。文件上传的同时，存储空间使用情况也会实时更新。上传接口在每个文件上传结束时返回上传结果状态 ，前端据此更新任务列表中的状态为完成或失败。

- **文件下载：** 用户可以下载自己网盘中的文件。下载有两种方式：

  1. **单个文件下载：** 在文件列表中选中某个文件，点击操作中的“下载”按钮，浏览器将开始下载该文件。例如上图中，用户点击名为“小鲤鱼历险记.mp3”的文件的“下载”按钮（红框标出）后，浏览器出现下载提示。系统通过`GET /api/file/download`接口返回文件内容流或下载链接，触发浏览器下载功能。

     ![image](https://github.com/HLH0423/EasyPan/assets/54101102/e3c937f8-6799-44ca-a8e6-0008175d0d97)

  2. **批量打包下载：** 如果支持多选，用户可以勾选多个文件后点击“批量下载”（界面中可能通过压缩打包实现）。本系统当前界面提供批量删除和移动，没有直接批量下载按钮，但用户可以逐个下载多个文件。如果需要批量下载，可由前端发送请求将多个文件打包成ZIP后提供单一下载。

特别地，对于**不支持在线预览**的文件类型，例如`.zip`压缩包或未知类型文件，用户点击文件名时会直接提示下载而非打开预览 。上图所示的下载操作也可以通过点击文件名实现（如果文件不可预览，则点击即下载）。下载在浏览器侧通过普通超链接或Blob方式实现，后台接口校验用户权限后提供文件流。

### 文件预览与操作

**文件预览：** 系统支持多种常见格式文件的在线预览，用户无需下载即可在浏览器中查看内容。支持的预览类型包括：视频（mp4等）、音频(mp3等)、图片(jpg/png/gif等)、文档（PDF、Word、Excel等，通过内置阅读器或第三方预览服务）、文本文件（txt、代码文件等以文本方式显示） 。对于这些支持预览的文件，用户点击文件名会在页面中打开预览窗口。预览窗口通常以弹层形式覆盖当前页面，并提供基本的查看控制，例如视频的播放/暂停、音频的播放控件、文档的翻页或缩放等，以及一个关闭按钮返回文件列表。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/7eab0864-a67d-4672-996a-b95923c46c46)
 *视频文件在线预览：用户点击一个MP4视频文件，弹出播放器窗口直接播放视频内容。“什么是微信小程序”幻灯片为视频内容示例，下方有播放进度控制。*

如上图，用户点击某视频文件后，页面中央出现视频播放器，支持播放/暂停、进度拖动、全屏等操作。视频文件是在服务器端以流式传输的方式发送，浏览器使用元素播放。音频文件预览类似。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/4f0de4fa-7e5c-4133-9ffe-8d2ee4ae3cde)
 *音频文件在线预览：图示为MP3音频的播放器界面，有专辑封面图片（如有)和播放进度条等。用户可以播放/暂停音频，查看时长等信息。*

音频文件点击后，会出现如上图的音频播放器（通常位于弹窗中部），可以播放背景音乐或语音文件。界面显示音频文件名和简单控制。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/77a11eb2-4cb2-4171-a13a-59e2405af8b8)
 *图片文件预览：以PNG图片为例，点击后在弹窗中央显示图片本身。背景半透明暗化当前界面，底部提供缩放查看的工具栏。*

图片文件点击后直接以图像形式显示，用户可以放大缩小或旋转（如果实现了这些功能）。文本文件和部分文档会以文字内容预览，例如代码文件会有高亮显示功能：

![image](https://github.com/HLH0423/EasyPan/assets/54101102/4289179a-bb70-49a4-95d0-decf8aca1860)
 *文本/代码文件预览：如图，用户点击一个`.txt`或代码文件，在浏览器中看到文本内容。支持选择不同字符编码查看（防止乱码)，并提供“复制”按钮快速复制全文。*

上图展示了一个文本文件（uploader.txt，其中包含Vue组件代码）的在线预览界面。顶部有编码切换和复制功能。如果出现乱码可尝试切换编码（如UTF-8、GBK等）。**Office文档（Word、Excel、PPT）和 PDF** 可以通过集成第三方预览服务或将其转换为HTML在浏览器中呈现；本系统支持 Excel、Doc、PDF 在线预览 。当用户打开这些文档类型时，系统会在后台将其转为PDF或图片，再在前端显示；或者利用浏览器自带能力直接显示PDF。

**文件操作：** 除了预览，用户可以对文件执行多种管理操作，包括**重命名、移动、删除**等。以下逐一说明：

![image](https://github.com/HLH0423/EasyPan/assets/54101102/ee8226c5-30c6-4f4f-87b6-8a374222fe6d)

- **重命名：** 用户在文件列表中选择“重命名”功能（例如点击文件行尾的“重命名”图标），文件名变为可编辑状态，如下图所示。用户输入新名称后按确认✓提交或✗取消。系统调用`POST /api/file/rename`接口修改文件名称，需要提供文件ID和新名称 。若重命名成功，列表即时更新名称。 例如上图，用户正在将文件“清单.xlsx”重命名，在名称后输入“(重命名)”作为新名称的一部分。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/86dd3b53-e426-47c1-9645-36032df1c19a)
 *文件重命名操作：选中某文件后，名称区域变为输入框，用户可输入新名称并点击勾号提交。图中将“清单.xlsx”重命名为“清单(重命名).xlsx”。*

- **移动（剪切/粘贴）：** 支持将文件或文件夹移动到其他目录。用户可以单选或多选文件，然后点击“批量移动”按钮。会弹出目标位置选择框，列出用户所有文件夹的层次结构，供选择移动的目的地。如下面两图所示：用户选择了两个文件准备移动，弹出“移动到”对话框，用户浏览文件夹树并指定目标文件夹，然后确认执行移动。![image](https://github.com/HLH0423/EasyPan/assets/54101102/cc27e2ca-88fa-4ce1-b039-9adf70dcc2e2)红框标出了批量移动按钮和单个文件的“移动”选项。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/2464e86d-2885-458d-b090-f5736852146b) *批量移动文件：弹出的“移动到”对话框中，用户可选择目标文件夹（如“新建文件夹(批量移动)”)。点击“移动到此”将所选文件移动过去。对话框顶部提供返回上一级和当前路径导航。*

移动文件请求由`POST /api/file/moveFile`接口处理，需提供所选文件ID列表和目标文件夹ID 。如果用户试图将文件移动到其所在的当前目录，前端会提示“不可移动” 。移动成功后，源目录列表移除该文件，目标目录中可看到新迁入的文件：

![image](https://github.com/HLH0423/EasyPan/assets/54101102/aedf4545-a225-4680-aef2-47d5101137e0)
 *移动完成：进入目标文件夹“新建文件夹(批量移动)”后，可看到红框标出的刚才移动进来的文件列表。*

- **删除：** 用户可删除单个文件或批量删除选定的多个文件。删除操作将文件移入**回收站**而非直接删除永久销毁。用户在文件列表中点击“删除”后，会弹出确认提示框（如下图），提示“删除的文件将在10天内彻底删除”。确认后，调用`POST /api/file/delFile`接口将文件状态标记为删除并移动至回收站 。例如：

![image](https://github.com/HLH0423/EasyPan/assets/54101102/1b5a778a-ca80-40a9-9688-77f460d90750)
 *删除文件：选中单个文件，点击删除图标，系统询问确认。上图红框标出单文件删除按钮。*

![image](https://github.com/HLH0423/EasyPan/assets/54101102/5bfd82a3-e603-45f6-a324-780d89fe8273)
 *批量删除文件：对勾选的多个文件点击“批量删除”按钮，会弹出确认对话框提示这些文件将进入回收站并在10天后永久删除。用户确认后，所选文件从当前列表消失并进入回收站。*

删除到回收站的机制确保用户可以在一定期限（默认10天）内还原误删文件。进入回收站的文件在数据库中标记状态为删除，实际文件仍保留在存储中直到超期或被彻底删除。后端提供回收站相关接口供查询和还原（详见后文）。在文件列表界面，删除操作后会自动刷新当前列表去掉已删除项，同时“回收站”页面能看到新进入的记录。

### 文件分享

文件分享模块允许用户将网盘中的文件生成分享链接，其他持有该链接的人可以通过浏览器访问文件。分享功能包括：创建分享（设置有效期和提取码）、获取分享链接、取消分享，以及分享链接的访问页面（提取码验证、浏览文件、下载或保存等）。分享分为**内部分享管理**（登录用户管理自己分享的文件）和**外部分享访问**（未登录用户通过链接访问分享）。

- **创建分享链接：** 在网盘主页，用户选中想分享的文件，点击“分享”操作。弹出“分享”设置对话框，用户可以选择**有效期**和**提取码**模式。下图示例中，用户分享文件“uploader.txt”，可选有效期为“永久有效”或1天/7天/30天等，提取码可以**自定义**（用户自行设置4-6位代码）或**系统随机生成**。用户设定后点击确认生成分享。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/8697edf2-b470-4de2-aa0b-6748b96e2c4e)



*设置文件分享：用户勾选“永久有效”的有效期，并选择“自定义”提取码模式然后输入提取码（如未输入则不会创建链接)。*

分享创建接口`POST /api/share/shareFile`会接受文件ID、有效期类型（如0表示永久，1表示1天等）以及用户自定义的提取码（如果有）。服务器生成唯一的分享ID和对应的提取码（若用户未自定义则随机生成），保存分享记录，包括分享者、文件引用、有效期和提取码等信息，然后返回分享链接。

 ![image](https://github.com/HLH0423/EasyPan/assets/54101102/4032962d-9e8c-404f-bf13-672953e1e241)
 *分享链接生成：系统返回生成的分享链接URL和提取码。用户可以一键复制“链接及提取码”并发送给他人。*

如上图，分享创建成功后弹窗显示**分享链接**（如`http://<域名>/share/RcfqPK...`这种格式）和**提取码**（例如12345）。用户可点击“复制链接及提取码”按钮快速复制完整分享信息。当勾选“不需要提取码”时（即系统随机但不提供给用户？实际一般至少系统也会给出提取码），本项目实现上总是会有提取码，除非在设置时允许空码。

- **分享管理（内部）:** 登录用户可以在“分享”页面查看自己已分享的文件列表，以及执行**复制链接**和**取消分享**操作。如下图所示“分享记录”列表，每条记录包含文件名、分享时间、失效时间、浏览次数等。用户点击“复制链接”可以再次获取该分享的链接和提取码，点击“取消分享”则立即让该链接失效。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/b2ad50e8-9ee4-42e8-9454-29053f5d1ad3)
 *分享管理页面：显示当前用户（admin)的所有分享记录。可以看到“uploader.txt”设为永久有效且已被访问1次，“video1.mp4”有效期到具体日期且浏览1次。操作列提供“复制链接”和“取消分享”。*

“分享记录”页面通过`POST /api/share/loadShareList`接口获取当前用户的分享列表 。取消分享调用`POST /api/share/cancelShare`，提交要取消的分享ID列表 。取消后，该分享链接将不再可用（后端会删除分享记录或标记失效）。浏览次数会在每次外部访问时累加记录，以供分享者查看分享的访问情况。

- **分享访问（外部分享）：** 未登录用户或任何获得分享链接的人，可以在浏览器访问该URL查看文件。默认需要输入分享者设置的**提取码**才可访问文件内容。如果分享时设置为无提取码（公开链接），则会直接显示内容页。访问流程如下：

  1. **访问分享链接：** 用户点击分享URL（例如`.../share/RcfqPK...`），系统呈现一个分享页面。页面显示该分享的基本信息（分享者昵称、分享时间、分享的文件名/文件夹名），并要求输入提取码进行验证。 如下图，访问者需要在输入框中填写正确的提取码才能“提取文件”。

  ![image](https://github.com/HLH0423/EasyPan/assets/54101102/1d2a4078-f4cb-4296-9f4d-b30d286ec952)
   *分享链接提取码验证页：显示分享者昵称（admin)和分享时间，分享文件名为uploader.txt。要求访问者输入提取码后点击“提取文件”按钮。只有提取码正确才能继续。*

  1. **提取码验证：** 访问者输入提取码后提交，前端调用`POST /api/showShare/checkCode`接口验证。若提取码正确，服务器返回通过，此时前端进入文件浏览页面；若错误，则提示提取码不正确需重试。每个分享ID通常有验证次数限制，以防暴力猜码。
  2. **浏览分享文件：** 提取码正确后，系统显示分享的文件内容列表。 如果分享的是单个文件，可能直接显示文件名和下载按钮；如果分享的是一个文件夹，列表中会显示该文件夹下的所有文件。访问者可以选择**下载文件**或**在线预览**（若文件格式支持）。如下图，admin分享的uploader.txt文件（文本文件）列出在页面，提供“下载”链接。此外右上角有“保存到我的网盘”按钮，供已登录的访问者（当前浏览器可能已登录某账号)将该文件保存进自己的云盘。

  ![image](https://github.com/HLH0423/EasyPan/assets/54101102/b2ad50e8-9ee4-42e8-9454-29053f5d1ad3)
   *分享文件列表页：显示分享者admin的文件列表（此例仅一个文件)，访问者可点击“下载”获取文件。右上角的“保存到我的网盘”按钮针对登录用户，允许将该文件复制到自己的网盘。*

  在此页面，未登录用户只能下载或预览文件；如果访问者此时登录了自己账号，则可以使用“保存到我的网盘”功能（详见下述）。
   访问页面在后台由`POST /api/showShare/getShareInfo`接口提供数据，返回分享文件的列表、文件属性以及分享者信息等 。如果分享的是文件夹，会有文件夹内列表数据。对于可以预览的文件，访问者点击文件名会在浏览器中打开预览（类似上述网盘预览功能），例如：

  ![image](https://github.com/HLH0423/EasyPan/assets/54101102/4289179a-bb70-49a4-95d0-decf8aca1860)
   *通过分享链接在线预览文件：上图为在分享页面直接查看文本文件内容的效果，和网盘内预览类似。访问者也可以选择直接下载而不预览。*

  1. **保存到我的网盘：** 当访问者已经登录（例如以用户test登录）并查看他人分享文件时，可以将该分享文件保存到自己网盘账户中。点击“保存到我的网盘”按钮，会弹出目标路径选择对话框，用户选择自己网盘的某个文件夹并确认后，系统将在后台复制该文件的数据到用户网盘中。下图为选择保存位置的对话框示例：

  ![image](https://github.com/HLH0423/EasyPan/assets/54101102/d77d398d-17db-463f-85fe-45e3a0de8325)
   *保存到网盘：弹出“移动到”对话框（与移动文件界面类似)供用户选择将文件保存到自己网盘的哪个目录。选定后点击“移动到此”开始保存。*

  前端调用`POST /api/showShare/saveShare`接口提交分享ID、所选文件（可批量）以及自己网盘的目标文件夹ID 。服务器会将分享文件复制一份到该用户的存储空间，并在其网盘文件列表中新建记录。复制成功后用户即可在网盘中看到该文件。 下图展示用户test的网盘中出现了红框标出的保存文件：

  ![image](https://github.com/HLH0423/EasyPan/assets/54101102/92a3a3f5-bbe4-4383-a69c-22b970b60160)
   *保存完成：在用户test网盘的文件列表中（右上角标注为用户test)，可以看到刚才从admin分享中保存的文件“uploader.txt”。*

  （**注意**：为实现保存功能，后端需要根据分享ID和文件ID读取源文件内容，再写入目标用户的文件目录中。接口要求参数包括`shareId`和`shareFileIds`（可以一次保存多个文件）以及目标目录ID `myFolderId` 。）

分享链接在有效期到达后会自动失效（他人访问将提示链接已失效）。分享者也可随时取消分享。整个分享流程中，确保只有持有正确提取码的人才能访问文件，保障了一定程度的安全性。

### 回收站

回收站用于管理用户删除的文件。功能包括查看已删除文件列表、还原文件、彻底删除文件。被删除的文件将在回收站保留一段时间（默认10天），超期后系统可自动清理或由管理员批量清理。

![image](https://github.com/HLH0423/EasyPan/assets/54101102/a8b4f019-8c4f-419b-bf9f-6735ece4afd8)
 *回收站页面：左侧提示“回收站为你保存10天内删除的文件”。右侧列出删除的文件及删除时间。提供“还原”和“批量删除”按钮。*

- **查看回收站：** 用户点击左侧菜单“回收站”进入该页面。通过`POST /api/recycle/loadRecycleList`接口获取属于自己的已删文件列表 。列表包括文件名、原所在路径（可能实现为隐藏列或提示信息）、删除时间、大小等。回收站中的文件不占用用户空间配额或者继续占用（通常仍算占用，因为文件还存在，只是不可见），这由实现决定。界面上方有两个操作按钮：“还原”和“批量删除”。
- **还原文件：** 用户选中一个或多个删除的文件，点击“还原”按钮，即可将这些文件恢复到原先删除前的位置。调用`POST /api/recycle/recoverFile`接口，提交需要还原的文件ID列表。服务端会将这些文件的状态标记为正常，并移动回原父目录。如果原目录已不存在（例如原文件夹已被删除），可将文件还原到用户根目录或者提示无法还原。还原成功后，用户可以在网盘主页相应位置重新看到该文件；回收站列表则移除该条目。
- **彻底删除：** 用户也可在回收站中彻底删除文件，使其无法再恢复。选中目标文件，点击“批量删除”按钮（红色），系统弹出确认提示后，调用`POST /api/recycle/delFile`接口删除 。彻底删除会移除文件的所有数据，占用空间释放。此操作不可撤销。通常也支持单个文件的彻底删除（界面可能在每行提供“删除”按钮或者通过批量删除实现单个）。彻底删除后，该文件从回收站列表消失。服务器也许会真正删除存储上的文件数据或者做延迟清理。

回收站确保误删文件可以自助找回，提高数据安全。系统应在文件删除10天后自动调用批量彻底删除（可通过定时任务实现），因此在回收站界面会显示剩余天数提醒或统一说明“删除的文件将在10天后自动删除”。

### 后台管理

后台管理模块仅对管理员账号开放。管理员登录后可以进入**设置**页面，包括三个子模块：**用户文件管理**、**用户管理**、**系统设置**。管理员可以查看并操作所有用户的文件，管理用户账户状态和配额，以及调整系统全局设置如邮件模板、默认空间大小等。

- **用户文件管理：** 管理员能够查看所有用户上传的文件列表，并执行管理操作。如下图，管理员在“用户文件”栏目下看到全体文件列表，增加了一列“发布人”显示文件属于哪个用户。管理员可以通过搜索框按文件名或用户筛选文件，并可对文件执行**批量删除**或预览查看等操作。比如，可帮助删除违法内容文件。点击文件名前的用户头像/昵称，可能可以跳转查看该用户的所有文件。批量删除文件会调用相应接口，将指定用户的文件移入其回收站或直接删除。管理员查看文件列表使用接口`POST /api/admin/loadAllFiles`或类似功能（项目实现可能复用普通文件列表接口但具有管理员权限可查看全部用户文件）。如图底部显示总文件数和分页。管理员也可点选文件然后点击“批量删除”来彻底删除用户文件。预览功能类似普通用户的预览，但管理员只读浏览。

  ![image](https://github.com/HLH0423/EasyPan/assets/54101102/9c47d2df-ef1b-44d3-ad23-1c5dd48abcb9)

- **用户管理：** 管理员可以查看当前注册的所有用户账户信息，并进行检索和状态变更。下图显示用户管理界面：列出了admin和test两个用户，包括头像、昵称、邮箱、已用/总空间、加入时间、最后登录时间、以及当前状态。管理员可以通过上方筛选“状态”或昵称关键字查找用户。对每个用户有操作按钮，比如“分配空间”或“修改配额”、和“禁用/启用”用户。

  - *查询用户：* 页面通过`POST /api/admin/loadUserList`接口获取用户列表 。可选提供筛选参数如状态（启用/禁用）或昵称模糊匹配 。

  - *分配空间：* 管理员可调整用户的总可用空间大小。点击“分配空间”操作会弹出输入框允许设置该用户的新空间上限（单位如GB）。确认后，调用`POST /api/admin/updateUserSpace`接口提交用户ID和新的空间值 。服务器更新用户配额信息。调整后列表会更新“空间使用”列（例如test用户原先10GB可改为5GB等）。

  - *禁用/启用用户：* 点击“禁用”会暂时冻结该用户账号的登录和操作权限。接口`POST /api/admin/updateUserStatus`修改用户状态为禁用 。被禁用用户将无法登录或其Token立即失效。再次点击会变为“启用”以恢复正常。管理员可用此功能封锁违规用户。

    ![image](https://github.com/HLH0423/EasyPan/assets/54101102/46880d65-055a-4d42-a19d-b7cc9b4ade12)

- **系统设置：** 管理员可以调整系统级别的一些配置项，如注册邮件模板和用户默认空间大小。 如下图，“系统设置”界面提供若干输入项：

  - 注册的邮件标题（如默认“邮箱验证码”）。
  - 注册的邮件内容模板（如“你好，您的邮箱验证码是：%s，15分钟有效” – 其中`%s`为验证码占位符）。
  - 初始空间大小（新用户注册时默认分配的空间配额，例如5，即5GB）。

  管理员修改这些字段后点击“保存”，将通过`POST /api/admin/saveSysSettings`接口提交 。服务器保存这些配置，并在后续注册或发送验证码邮件时采用新的模板或参数。比如将默认空间从5改为10，新注册用户totalSpace将为10GB。邮件模板更改后，邮件发送接口返回的内容将根据新模板生成验证码邮件。系统设置变更通常对已存在用户无影响（除非修改初始空间不会自动改变已有用户配额，只作用于新用户）。

  ![image](https://github.com/HLH0423/EasyPan/assets/54101102/27768001-74e7-4842-8c33-f0d5897c61bc)

后台管理模块确保管理员能够监督系统资源使用及用户行为，维护系统安全与稳定。例如，管理员可以定期巡查用户文件，清理违规内容，或扩容某些用户的存储空间。此模块也可以扩展更多功能，如查看系统总体存储占用、日志审计等。

## 非功能性需求

除了上述功能点，系统还需满足一系列非功能性要求，以确保性能、并发和安全等方面的品质：

- **性能要求：**
  - *上传/下载性能：* 支持大文件的高效传输，要求单文件上传支持至少**5GB**大小，分片并行上传加快速度，同时服务器对接收的分片及时写入合并。秒传功能减少重复上传，提高了整体性能。下载应能充分利用带宽，服务器对热门下载可采用**带宽控制**或CDN缓存，以保证多人同时下载的速度。
  - *响应时间：* 常规页面接口（登录验证、文件列表查询等）响应时间应在**100ms**以内（不含网络延迟）；文件上传分片和下载响应则根据大小而定，但也应优化IO，尽量流式处理大文件避免长时间占用内存。
  - *容量与扩展：* 系统应能支持**上万用户**规模，每个用户有数千文件而性能不会明显下降。存储层要易于扩展，可通过增加硬盘或分布式存储扩容。数据库索引优化确保大量文件元数据查询高效。
- **并发处理：**
  - 系统需支持**多用户并发上传/下载**。服务端采用异步IO或多线程处理文件读写，保证在几十甚至上百个并发上传/下载时服务器仍能稳定运行。建议对同时上传的分片请求进行调度，防止资源争夺。
  - 数据库并发：采用事务/锁机制确保并发修改同一资源（如同时两个操作修改用户空间）时数据一致。对于文件的并发访问，如果同一文件同时被多人下载，需有良好的读并发性能；如被多人同时上传（理论上不发生同一文件ID并发上传，除非断点续传场景，也要处理并发resume的情况）。
  - 前端并发：前端应限制同时上传的文件数量（例如同时3-5个分片任务）以避免过度占用浏览器和网络资源；服务端也可限制每用户最大并发上传数。
- **安全性要求：**
  - *身份与权限：* 所有接口需要进行用户身份认证（除了分享链接相关的公开接口）。采用Token（如JWT）或Session机制保存登录态，每个请求都验证Token有效性。不同用户隔离，严禁未授权访问他人文件。后台管理接口需验证管理员权限。
  - *数据传输安全：* 建议部署HTTPS，防止传输过程被窃听篡改。上传的文件MD5需在服务端校验，以防止数据错误。对于敏感操作（删除、修改密码等）可增加二次确认或更严格权限控制。
  - *验证码与频率限制：* 登录和注册引入图形验证码，防止暴力破解密码或滥用注册。邮件验证码接口应对单IP或单邮箱请求频率做限制（如每分钟一次），防止邮件轰炸。提取码验证也需限制错误次数，错误多次可短暂锁定分享访问或要求稍后再试。
  - *存储安全：* 用户上传的文件存储在服务器指定目录，需防范路径遍历等漏洞（接口只允许合法文件名和路径）。存储中的文件可根据需要加密保存（本系统未提及，默认明文存储即可）。定期备份用户文件元数据和重要数据，防止意外丢失。
  - *防注入攻击：* 后端对所有输入参数进行校验和过滤，防止SQL注入、脚本注入。文件名、昵称等字段禁止包含恶意脚本；搜索接口对特殊字符转义。数据库接口使用参数化查询。
  - *日志审计：* 记录用户的关键操作日志（登录、文件分享、删除等）以备审计。管理员可以查看异常行为。
- **兼容性与可用性要求：**
  - *浏览器兼容：* 前端页面在主流浏览器上表现一致，包括Chrome、Firefox、Edge等现代浏览器，以及移动端浏览器的基本适配。使用HTML5特性实现预览和上传分片，需提示用户使用新版浏览器。IE等老旧浏览器可不重点支持或给出不兼容提示。
  - *响应式和易用性：* 界面布局尽量自适应不同尺寸屏幕，在较大分辨率下利用空间显示更多内容，在窄屏（移动端）下能够纵向排布主要功能。但由于网盘主要场景在PC，移动端可简化一些操作。交互流程清晰，例如上传提供进度反馈，操作成功或失败有消息提示。
  - *可用性：* 提供必要的错误提示和帮助信息。例如登录失败告知原因，分享码错误时提示剩余尝试次数等。确保长时间运行稳定，避免内存泄漏导致服务崩溃。文件操作尽量防止用户误操作：删除时确认、批量操作时列出选中项等。
  - *扩展性：* 系统设计模块清晰，方便未来功能扩展，如加入文件在线编辑、视频压缩预览、更多第三方登录等。代码应遵循良好规范，接口设计通用化，文档齐全，以利于后续开发团队维护。

综上，非功能需求关注系统高并发下的性能稳定，以及安全可靠地保护用户数据。通过合理的架构（如前后端分离、分片上传、权限校验）和优化（缓存、并发控制），确保系统在复杂场景下依然可用。

## 页面流程及交互说明

为了帮助理解系统的业务流程，这里选取两个具有代表性的功能场景**（文件分享流程**和**回收站文件处理流程）**进行说明：

### 文件分享流程

1. **用户发起分享**：登录用户在网盘主页选中需要分享的文件，点击“分享”按钮。前端调用分享创建接口，弹出设置对话框让用户选择有效期和提取码。用户确认后，前端收到接口返回的分享链接URL和提取码。
2. **发送分享信息**：用户将分享链接以及提取码发送给好友或公开发布。此时系统后台保存了分享记录，包括分享者ID、文件ID、提取码和有效期等。
3. **访问者打开链接**：访问者通过浏览器打开分享URL。系统检测该链接对应的分享记录存在且未过期，然后显示提取码输入页面（如果分享有提取码）。访问者输入提取码，前端调用提取码校验接口验证。
4. **提取码验证**：如果提取码正确，前端调用获取分享文件信息接口，加载文件列表或文件详情页面；如果提取码错误，页面提示错误并可重新输入（错误次数过多可能暂时锁定）。
5. **显示文件内容**：提取码通过后，访问者看到分享的文件列表。如果只分享了一个文件，直接显示该文件名、大小等，并提供“下载”按钮；如果分享的是一个文件夹，则显示其中的文件列表，可逐层浏览。
6. **下载或预览**：访问者可以选择点击“下载”按钮，通过`/api/showShare/download`接口获取文件进行下载；或者如果文件支持在线预览（如图片、视频），直接在浏览器中打开预览界面，查看文件内容。
7. **（可选）保存文件**：如果访问者此时已登录自己的账号，并希望将此文件保存起来，可以点击“保存到我的网盘”。随后系统会要求选择保存位置，确认后调用`saveShare`接口，将文件复制到访问者网盘中。保存成功后访问者在自己的文件列表即可看到该文件。
8. **分享者管理**：分享期间，分享者可以随时在“分享管理”页面查看刚才分享的文件，被访问的次数，并可以选择取消分享。如果取消，后台标记链接失效，之后访问此链接将提示“链接已失效”而无法查看文件。
9. **分享过期**：如果分享设置了有效期，比如7天，超过有效期后，任何人访问该链接都会收到失效提示。分享者自己在管理页也会看到该分享标记为已过期（可手动删除记录）。

*交互要点：* 分享者在生成链接时要清楚提示提取码和有效期；访问者输错提取码时给予明确反馈；如果分享文件较多，访问者页面需支持分页或逐步加载。保存到网盘功能仅对已登录用户提供，对未登录用户可隐藏该按钮或引导其先登录。

### 回收站流程

1. **用户删除文件**：用户在网盘主页选择一个文件，点击“删除”。前端弹出确认提示（例如“确认删除? 文件可在回收站找回”），用户确认后调用删除接口。接口响应成功，文件从用户当前文件列表消失，转入回收站。
2. **查看回收站**：用户切换到“回收站”页面，前端调用`loadRecycleList`接口获取已删除文件列表。用户可以在回收站看到刚才删除的文件条目，包括文件名、删除时间等。如果删除文件较多，支持分页查看和搜索筛选。
3. **还原文件**：若用户误删了文件，此时可在回收站中选中该文件，点击“还原”。前端调用`recoverFile`接口，请求后台将文件恢复。后台将文件状态改为正常并移动回原目录。前端收到成功响应后，提示“还原成功”。用户可以回到原来所在的文件夹查看，该文件已经重新出现，和删除前保持相同的位置和内容。
4. **彻底删除**：用户也可以在回收站中彻底删除某文件，不再保留。选中文件后点击“彻底删除”或“批量删除”按钮。系统弹出最终确认（“文件删除后将无法恢复，确认继续？”）。用户确认则前端调用`delFile`接口，后台删除文件数据。前端从回收站列表移除该文件项，并提示“已永久删除”。
5. **自动清理**：如果用户长时间未操作回收站，系统也会自动清理超过保留期限的文件。例如保留期10天，那么第11天开始这些文件就不再出现在回收站列表（后台清理时调用同样的delFile逻辑）。用户登陆后查看回收站会发现过期的文件条目已经没有了。
6. **特殊情况**：如果用户在回收站还原文件时，原文件夹也在回收站中（例如删除了一个包含文件的文件夹），系统应优先还原原文件夹结构再放回文件，或将文件还原到根目录并提示用户。此类复杂情况实现中需要有相应策略。

*交互要点：* 删除和还原操作都需要提示用户结果，比如删除后在页面显示“文件已移至回收站”，还原后显示“文件已恢复”。回收站界面应明显告知用户保留期限，避免误解文件会一直留在那里。对于永久删除操作，因不可逆，需要二次确认，且按钮样式宜为警示色。系统自动清理在后台进行，可能不直接告知用户，但用户应能在文档或帮助中得知这个策略。

以上两个流程展示了本系统在关键使用场景下的交互步骤和逻辑处理。通过这些流程，用户能够较方便地分享文件给他人并找回误删文件，体验接近真实的网盘服务。整个系统其他功能（如上传下载流程、管理员操作流程等）也应有类似顺畅和安全的交互设计，限于篇幅不再详述。